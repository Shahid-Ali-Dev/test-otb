{% extends "base.html" %}

{% block title %}Advanced Analytics - Shout OTB{% endblock %}

{% block extra_css %}
<!-- Chart.js for beautiful graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* =========================
   ADVANCED ANALYTICS STYLES
========================= */
:root {
    --chart-primary: #ff6b35;
    --chart-success: #28a745;
    --chart-warning: #ffc107;
    --chart-danger: #dc3545;
    --chart-info: #17a2b8;
}

.analyzer-hero {
    background: linear-gradient(135deg, var(--primary-black) 0%, #1a1a1a 100%);
    padding: 3rem 0;
    border-bottom: 1px solid rgba(255, 107, 53, 0.3);
    position: relative;
    overflow: hidden;
}

.analyzer-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 20%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
}

.hero-title {
    font-size: 2.8rem;
    font-weight: 800;
    background: linear-gradient(135deg, #fff 0%, var(--accent-orange) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
}

.hero-subtitle {
    font-size: 1.1rem;
    color: var(--text-gray);
    margin-bottom: 1.5rem;
}

/* Platform Tabs */
.platform-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    background: var(--secondary-black);
    padding: 0.5rem;
    border-radius: 15px;
    border: 1px solid rgba(255, 107, 53, 0.2);
}

.platform-tab {
    background: transparent;
    border: none;
    color: var(--text-light);
    padding: 1rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.platform-tab.active {
    background: var(--accent-orange);
    color: var(--primary-black);
    box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
}

.platform-tab:hover:not(.active) {
    background: rgba(255, 107, 53, 0.1);
    color: var(--accent-orange);
}

/* Analytics Grid */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.analytics-card {
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 107, 53, 0.15);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.analytics-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-orange), transparent);
}

.analytics-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent-orange);
    box-shadow: 0 8px 25px rgba(255, 107, 53, 0.15);
}

.metric-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.metric-title {
    color: var(--text-light);
    font-weight: 600;
    margin: 0;
    font-size: 0.95rem;
    opacity: 0.9;
}

.metric-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: rgba(255, 107, 53, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent-orange);
    font-size: 1rem;
}

.metric-value {
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--accent-orange);
    margin-bottom: 0.5rem;
    line-height: 1;
}

.metric-change {
    display: flex;
    align-items: center;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
    width: fit-content;
}

.metric-change.positive {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.metric-change.negative {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
}

.metric-change.neutral {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
}

.metric-label {
    color: var(--text-gray);
    font-size: 0.8rem;
    line-height: 1.4;
    margin-top: 0.5rem;
    opacity: 0.8;
}

/* Data Source Badge */
.data-source-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    background: rgba(255, 107, 53, 0.1);
    color: var(--accent-orange);
    border: 1px solid rgba(255, 107, 53, 0.3);
}

/* Refresh Button */
.refresh-btn {
    background: var(--accent-orange);
    color: var(--primary-black);
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.refresh-btn:hover {
    background: #ff8c5a;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
}

.refresh-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* Performance Badge */
.performance-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.2rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
}

.performance-excellent {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
    border: 1px solid rgba(40, 167, 69, 0.3);
}

.performance-good {
    background: rgba(255, 193, 7, 0.1);
    color: #ffc107;
    border: 1px solid rgba(255, 193, 7, 0.3);
}

.performance-average {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
    border: 1px solid rgba(108, 117, 125, 0.3);
}

.performance-poor {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    border: 1px solid rgba(220, 53, 69, 0.3);
}

/* Platform Header */
.platform-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    border: 1px solid rgba(255, 107, 53, 0.15);
    position: relative;
    overflow: hidden;
}

.platform-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-orange), transparent);
}

.platform-logo {
    width: 70px;
    height: 70px;
    border-radius: 16px;
    background: linear-gradient(135deg, #ff0000, #ff6b35);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.8rem;
    font-weight: bold;
    flex-shrink: 0;
    box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
}

.platform-info {
    flex: 1;
}

.platform-info h3 {
    color: var(--text-light);
    margin: 0 0 0.3rem 0;
    font-size: 1.5rem;
    font-weight: 700;
}

.platform-info p {
    color: var(--text-gray);
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Charts Grid */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.chart-container {
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 107, 53, 0.15);
    position: relative;
    overflow: hidden;
}

.chart-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-orange), transparent);
}

.chart-title {
    color: var(--text-light);
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.chart-wrapper {
    position: relative;
    height: 300px;
    width: 100%;
}

/* Insights Grid */
.insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.insight-card {
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 107, 53, 0.15);
    transition: all 0.3s ease;
}

.insight-card:hover {
    transform: translateY(-3px);
    border-color: var(--accent-orange);
}

.insight-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.insight-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: rgba(255, 107, 53, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent-orange);
    font-size: 1.3rem;
}

.insight-content h4 {
    color: var(--text-light);
    margin: 0 0 0.3rem 0;
    font-weight: 700;
    font-size: 1.1rem;
}

.insight-content p {
    color: var(--text-gray);
    margin: 0;
    font-size: 0.85rem;
    opacity: 0.8;
}

.insight-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.8rem;
    margin-top: 1rem;
}

.stat-item {
    text-align: center;
    padding: 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

.stat-value {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--accent-orange);
    margin-bottom: 0.2rem;
}

.stat-label {
    color: var(--text-gray);
    font-size: 0.75rem;
    opacity: 0.8;
}

/* Suggestions Grid */
.suggestions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
}

.suggestion-card {
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 107, 53, 0.15);
    border-left: 4px solid var(--accent-orange);
    transition: all 0.3s ease;
}

.suggestion-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(255, 107, 53, 0.1);
}

.suggestion-icon {
    font-size: 2rem;
    color: var(--accent-orange);
    margin-bottom: 0.8rem;
}

.suggestion-title {
    color: var(--text-light);
    font-weight: 700;
    margin-bottom: 0.8rem;
    font-size: 1.1rem;
}

.suggestion-desc {
    color: var(--text-gray);
    font-size: 0.85rem;
    line-height: 1.5;
    margin-bottom: 1rem;
    opacity: 0.8;
}

.suggestion-action {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent-orange);
    font-weight: 600;
    font-size: 0.85rem;
    text-decoration: none;
    transition: all 0.3s ease;
}

.suggestion-action:hover {
    gap: 0.8rem;
    color: #ff8c5a;
}

/* Platform Content */
.platform-content {
    display: none;
    animation: fadeInUp 0.6s ease;
}

/* Comparison Section */
.comparison-section {
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    border: 1px solid rgba(255, 107, 53, 0.15);
}

.comparison-title {
    color: var(--text-light);
    font-weight: 700;
    margin-bottom: 1.5rem;
    font-size: 1.2rem;
    text-align: center;
}

.comparison-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
}

.comparison-item {
    text-align: center;
    padding: 1.2rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.comparison-item:hover {
    transform: translateY(-3px);
    background: rgba(255, 107, 53, 0.1);
}

.comparison-value {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--accent-orange);
    margin-bottom: 0.3rem;
}

.comparison-label {
    color: var(--text-gray);
    font-size: 0.8rem;
    opacity: 0.8;
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fade-in {
    animation: fadeInUp 0.6s ease;
}

/* Alert Styles */
.alert {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    min-width: 300px;
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .analytics-grid {
        grid-template-columns: 1fr;
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .platform-header {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .platform-tabs {
        flex-direction: column;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .chart-wrapper {
        height: 200px;
    }
    
    .insights-grid,
    .suggestions-grid {
        grid-template-columns: 1fr;
    }
}

/* Loading States */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top: 2px solid var(--accent-orange);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Progress Bars */
.progress-container {
    margin: 1rem 0;
}

.progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    color: var(--text-light);
    font-size: 0.85rem;
}

.progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-orange), #ff8c5a);
    border-radius: 10px;
    transition: width 1s ease;
}
/* Content Gaps Styling */
.content-gaps-container {
    margin: 1.5rem 0;
}

.content-gaps-title {
    color: var(--text-light);
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.content-gaps-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
    margin-bottom: 0.5rem;
}

.content-gap-badge {
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.15), rgba(255, 107, 53, 0.25));
    color: #ff6b35;
    border: 1px solid rgba(255, 107, 53, 0.3);
    padding: 0.6rem 1rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.content-gap-badge::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #ff6b35, transparent);
}

.content-gap-badge:hover {
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.25), rgba(255, 107, 53, 0.35));
    border-color: #ff6b35;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
}

.content-gap-badge i {
    margin-right: 0.4rem;
    font-size: 0.8rem;
}

.content-gaps-description {
    color: var(--text-gray);
    font-size: 0.8rem;
    opacity: 0.8;
    font-style: italic;
}

/* Empty state */
.content-gaps-empty {
    text-align: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(255, 107, 53, 0.1);
}

.content-gaps-empty i {
    font-size: 2rem;
    color: #ff6b35;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.content-gaps-empty p {
    color: var(--text-gray);
    margin: 0;
    font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 768px) {
    .content-gaps-grid {
        gap: 0.6rem;
    }
    
    .content-gap-badge {
        padding: 0.5rem 0.8rem;
        font-size: 0.8rem;
    }
}
/* Enhanced Chart Styles */
.chart-container {
    background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 107, 53, 0.15);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.chart-container:hover {
    border-color: rgba(255, 107, 53, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 107, 53, 0.1);
}

.chart-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-orange), transparent);
}

.chart-title {
    color: var(--text-light);
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.chart-wrapper {
    position: relative;
    height: 300px; /* Increased height for better visibility */
    width: 100%;
}

.chart-legend {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-gray);
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

/* Chart tooltip customization */
.chartjs-tooltip {
    background: rgba(42, 42, 42, 0.95) !important;
    border: 1px solid rgba(255, 107, 53, 0.3) !important;
    border-radius: 8px !important;
    padding: 0.5rem 0.8rem !important;
    color: var(--text-light) !important;
    backdrop-filter: blur(10px);
}

/* Animation classes */
.chart-fade-in {
    animation: chartFadeIn 0.8s ease-out;
}

@keyframes chartFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Progress ring for single metrics */
.progress-ring {
    transform: rotate(-90deg);
}

.progress-ring-circle {
    transition: stroke-dashoffset 1.5s ease-in-out;
    transform-origin: 50% 50%;
}
</style>
{% endblock %}

{% block content %}
<!-- Analyzer Hero -->
<section class="analyzer-hero">
    <div class="container">
        <div class="row">
            <div class="col-12 fade-in-element">
                <h1 class="hero-title text-center">Advanced Analytics Dashboard</h1>
                <p class="hero-subtitle text-center">Real-time insights and AI-powered recommendations for your digital presence</p>
                
                <!-- Data Source Info -->
                <div class="mb-3 text-center">
                    <span class="data-source-badge me-2">
                        <i class="fas fa-database"></i>
                        {% if youtube_data and youtube_data.data_source == 'youtube_api_v3' %}
                            Live YouTube Data
                        {% elif youtube_data and youtube_data.data_source == 'cached_7day' %}
                            Cached Data (7 days)
                        {% else %}
                            Example Data
                        {% endif %}
                    </span>
                    <span class="data-source-badge">
                        <i class="fas fa-robot"></i>
                        AI-Powered Insights
                    </span>
                    {% if youtube_data and youtube_data.data_source == 'cached_7day' %}
                    <span class="data-source-badge" style="background: rgba(255, 193, 7, 0.1); color: #ffc107; border-color: rgba(255, 193, 7, 0.3);">
                        <i class="fas fa-clock"></i>
                        Using Cached Data
                    </span>
                    {% endif %}
                </div>
                
                <!-- Refresh Buttons -->
                <div class="refresh-buttons text-center">
                    <button class="btn btn-custom refresh-analytics-btn me-2" 
                            data-platform="youtube" 
                            data-identifier="{{ youtube_channel_id }}"
                            data-force-refresh="true">
                        <i class="fas fa-sync-alt"></i> 
                        {% if youtube_data and youtube_data.data_source == 'cached_7day' %}
                            Force Refresh YouTube Data
                        {% else %}
                            Refresh YouTube Data
                        {% endif %}
                    </button>
                    <button class="btn btn-outline-custom refresh-analytics-btn" 
                            data-platform="instagram" 
                            data-identifier="{{ instagram_username }}"
                            data-force-refresh="true">
                        <i class="fas fa-sync-alt"></i> Refresh Instagram Data
                    </button>
                    
                    {% if youtube_data and youtube_data.data_source == 'cached_7day' %}
                    <div class="mt-2">
                        <small class="text-warning">
                            <i class="fas fa-info-circle"></i>
                            Using cached data to save API quota. Click "Force Refresh" to get fresh data.
                        </small>
                    </div>
                    {% endif %}
                </div>
<!-- Platform Tabs -->
<section class="py-4">
    <div class="container">
        <div class="platform-tabs">
            <button class="platform-tab active" data-platform="youtube">
                <i class="fab fa-youtube"></i>
                YouTube Analytics
            </button>
            <button class="platform-tab" data-platform="instagram">
                <i class="fab fa-instagram"></i>
                Instagram Insights
            </button>
            <button class="platform-tab" data-platform="overview">
                <i class="fas fa-chart-network"></i>
                Performance Overview
            </button>
        </div>
    </div>
</section>

<!-- YouTube Analytics -->
<div id="youtube-analytics" class="platform-content">
    <div class="container">
        <!-- Platform Header -->
        <div class="platform-header fade-in">
            <div class="platform-logo">
                <i class="fab fa-youtube"></i>
            </div>
            <div class="platform-info">
                <h3>{{ youtube_data.channel_title if youtube_data and youtube_data.channel_title else 'YouTube Channel' }}</h3>
                <p>
                    {% if youtube_data and youtube_data.subscribers > 0 %}
                        {{ youtube_data.subscribers|format_number }} subscribers • 
                        {{ youtube_data.total_views|format_number }} views • 
                        {{ youtube_data.total_videos }} videos
                    {% else %}
                        Connect your YouTube channel to see analytics
                    {% endif %}
                </p>
            </div>
            <div class="performance-badge {{ youtube_data.performance_tier|lower if youtube_data and youtube_data.performance_tier else 'performance-average' }}">
                <i class="fas fa-{{ 'trophy' if youtube_data and youtube_data.performance_tier == 'Excellent' else 'chart-line' }}"></i>
                {{ youtube_data.performance_tier if youtube_data and youtube_data.performance_tier else 'No Data' }} Performance
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="analytics-grid">
            <!-- Subscribers -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Total Subscribers</h4>
                    <div class="metric-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.subscribers|format_number if youtube_data and youtube_data.subscribers else '0' }}</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.subscribers and youtube_data.subscribers > 0 else 'neutral' }}">
                    <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.subscribers and youtube_data.subscribers > 0 else 'right' }} me-1"></i>
                    {% if youtube_data and youtube_data.growth_predictions %}
                        {{ youtube_data.growth_predictions.predicted_monthly_growth_rate|round(1) }}% growth
                    {% else %}
                        No data
                    {% endif %}
                </div>
                <div class="metric-label">
                    {% if youtube_data and youtube_data.channel_age_days %}
                        Channel age: {{ youtube_data.channel_age_days }} days
                    {% else %}
                        Connect YouTube for data
                    {% endif %}
                </div>
            </div>

            <!-- Total Views -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Total Views</h4>
                    <div class="metric-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.total_views|format_number if youtube_data and youtube_data.total_views else '0' }}</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.total_views and youtube_data.total_views > 0 else 'neutral' }}">
                    <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.total_views and youtube_data.total_views > 0 else 'right' }} me-1"></i>
                    {% if youtube_data and youtube_data.channel_age_days and youtube_data.total_views %}
                        {{ (youtube_data.total_views / youtube_data.channel_age_days)|round|int }} daily
                    {% else %}
                        No data
                    {% endif %}
                </div>
                <div class="metric-label">
                    {% if youtube_data and youtube_data.engagement_metrics %}
                        {{ youtube_data.engagement_metrics.videos_analyzed }} videos analyzed
                    {% else %}
                        No video data
                    {% endif %}
                </div>
            </div>

            <!-- Engagement Rate -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Engagement Rate</h4>
                    <div class="metric-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.engagement_rate|round(1) if youtube_data and youtube_data.engagement_rate else '0' }}%</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.engagement_rate and youtube_data.engagement_rate > 4 else 'neutral' }}">
                    <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.engagement_rate and youtube_data.engagement_rate > 4 else 'right' }} me-1"></i>
                    {{ youtube_data.engagement_health if youtube_data and youtube_data.engagement_health else 'Unknown' }}
                </div>
                <div class="metric-label">
                    {% if youtube_data and youtube_data.engagement_rate %}
                        Industry average: 4.2%
                    {% else %}
                        Connect for engagement data
                    {% endif %}
                </div>
            </div>

            <!-- Channel Health -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Channel Health</h4>
                    <div class="metric-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.channel_health|round(1) if youtube_data and youtube_data.channel_health else '0' }}/100</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.channel_health and youtube_data.channel_health > 60 else 'neutral' }}">
                    <i class="fas fa-{{ 'trophy' if youtube_data and youtube_data.channel_health and youtube_data.channel_health > 80 else 'chart-line' }} me-1"></i>
                    {{ youtube_data.performance_tier if youtube_data and youtube_data.performance_tier else 'No Data' }}
                </div>
                <div class="metric-label">
                    {% if youtube_data and youtube_data.growth_potential %}
                        Growth Potential: {{ youtube_data.growth_potential }}
                    {% else %}
                        AI health score
                    {% endif %}
                </div>
            </div>

            <!-- Total Likes -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Total Likes</h4>
                    <div class="metric-icon">
                        <i class="fas fa-thumbs-up"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.total_likes|format_number if youtube_data and youtube_data.total_likes else '0' }}</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.total_likes and youtube_data.total_likes > 0 else 'neutral' }}">
                    <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.total_likes and youtube_data.total_likes > 0 else 'right' }} me-1"></i>
                    {% if youtube_data and youtube_data.avg_likes_per_video %}
                        {{ youtube_data.avg_likes_per_video|round(1) }}/video
                    {% else %}
                        No data
                    {% endif %}
                </div>
                <div class="metric-label">
                    {% if youtube_data and youtube_data.engagement_metrics %}
                        {{ youtube_data.engagement_metrics.videos_analyzed }} videos analyzed
                    {% else %}
                        Like engagement
                    {% endif %}
                </div>
            </div>

            <!-- Total Comments -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Total Comments</h4>
                    <div class="metric-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.total_comments|format_number if youtube_data and youtube_data.total_comments else '0' }}</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.total_comments and youtube_data.total_comments > 0 else 'neutral' }}">
                    <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.total_comments and youtube_data.total_comments > 0 else 'right' }} me-1"></i>
                    {% if youtube_data and youtube_data.avg_comments_per_video %}
                        {{ youtube_data.avg_comments_per_video|round(1) }}/video
                    {% else %}
                        No data
                    {% endif %}
                </div>
                <div class="metric-label">
                    Audience interaction and feedback
                </div>
            </div>

            <!-- Average Views Per Video -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Avg Views/Video</h4>
                    <div class="metric-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.avg_views_per_video|round(1)|format_number if youtube_data and youtube_data.avg_views_per_video else '0' }}</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.avg_views_per_video and youtube_data.avg_views_per_video > 1000 else 'neutral' }}">
                    <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.avg_views_per_video and youtube_data.avg_views_per_video > 1000 else 'right' }} me-1"></i>
                    Per video average
                </div>
                <div class="metric-label">
                    {% if youtube_data and youtube_data.engagement_metrics %}
                        {{ youtube_data.engagement_metrics.total_recent_views|format_number }} recent views
                    {% else %}
                        No recent data
                    {% endif %}
                </div>
            </div>

            <!-- Performance Consistency -->
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Performance Consistency</h4>
                    <div class="metric-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                </div>
                <div class="metric-value">{{ youtube_data.performance_consistency|round(1) if youtube_data and youtube_data.performance_consistency else '0' }}%</div>
                <div class="metric-change {{ 'positive' if youtube_data and youtube_data.performance_consistency and youtube_data.performance_consistency > 70 else 'neutral' }}">
                    <i class="fas fa-{{ 'check-circle' if youtube_data and youtube_data.performance_consistency and youtube_data.performance_consistency > 70 else 'chart-line' }} me-1"></i>
                    Consistency score
                </div>
                <div class="metric-label">
                    How consistent your video performance is across uploads
                </div>
            </div>

         <!-- Optimal Video Length -->
            <div class="analytics-card fade-in">
            <div class="metric-header">
                <h4 class="metric-title">Optimal Video Length</h4>
                <div class="metric-icon">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="metric-value">
                {% if youtube_data and youtube_data.optimal_video_length and youtube_data.optimal_video_length != 'Unknown' %}
                    {{ youtube_data.optimal_video_length }}
                {% else %}
                    Unknown
                {% endif %}
            </div>
            <div class="metric-change neutral">
                <i class="fas fa-ruler me-1"></i>
                Recommended
            </div>
            <div class="metric-label">
                Based on your best performing content
            </div>
        </div>

        <!-- Performance Trend -->
        <div class="analytics-card fade-in">
            <div class="metric-header">
                <h4 class="metric-title">Performance Trend</h4>
                <div class="metric-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="metric-value">
                {% if youtube_data and youtube_data.performance_trend %}
                    {{ youtube_data.performance_trend }}
                {% else %}
                    Unknown
                {% endif %}
            </div>
            <div class="metric-change {{ 'positive' if youtube_data and youtube_data.performance_trend == 'Improving' else 'negative' if youtube_data and youtube_data.performance_trend == 'Declining' else 'neutral' }}">
                <i class="fas fa-arrow-{{ 'up' if youtube_data and youtube_data.performance_trend == 'Improving' else 'down' if youtube_data and youtube_data.performance_trend == 'Declining' else 'right' }} me-1"></i>
                Trend
            </div>
            <div class="metric-label">
                Recent performance direction
            </div>
        </div>

        <!-- Content Quality Score -->
        <div class="analytics-card fade-in">
            <div class="metric-header">
                <h4 class="metric-title">Content Quality</h4>
                <div class="metric-icon">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="metric-value">{{ youtube_data.content_quality_score|round(1) if youtube_data and youtube_data.content_quality_score else '0' }}/100</div>
            <div class="metric-change {{ 'positive' if youtube_data and youtube_data.content_quality_score and youtube_data.content_quality_score > 70 else 'neutral' }}">
                <i class="fas fa-{{ 'trophy' if youtube_data and youtube_data.content_quality_score and youtube_data.content_quality_score > 80 else 'star' }} me-1"></i>
                Quality score
            </div>
            <div class="metric-label">
                AI-assessed content quality
            </div>
        </div>

        <!-- Average Duration -->
        <div class="analytics-card fade-in">
            <div class="metric-header">
                <h4 class="metric-title">Avg Duration</h4>
                <div class="metric-icon">
                    <i class="fas fa-film"></i>
                </div>
            </div>
            <div class="metric-value">
                {% if youtube_data and youtube_data.avg_duration_seconds %}
                    {{ (youtube_data.avg_duration_seconds / 60)|round(1) }} min
                {% else %}
                    0 min
                {% endif %}
            </div>
            <div class="metric-change neutral">
                <i class="fas fa-clock me-1"></i>
                Per video
            </div>
            <div class="metric-label">
                Average video length
            </div>
        </div>

        <!-- Engagement Consistency -->
        <div class="analytics-card fade-in">
            <div class="metric-header">
                <h4 class="metric-title">Engagement Consistency</h4>
                <div class="metric-icon">
                    <i class="fas fa-bullseye"></i>
                </div>
            </div>
            <div class="metric-value">{{ youtube_data.engagement_consistency|round(1) if youtube_data and youtube_data.engagement_consistency else '0' }}%</div>
            <div class="metric-change {{ 'positive' if youtube_data and youtube_data.engagement_consistency and youtube_data.engagement_consistency > 70 else 'neutral' }}">
                <i class="fas fa-{{ 'check-circle' if youtube_data and youtube_data.engagement_consistency and youtube_data.engagement_consistency > 70 else 'chart-line' }} me-1"></i>
                Consistency
            </div>
            <div class="metric-label">
                How consistent your engagement is
            </div>
        </div>

        <!-- Top Performing Video -->
        <div class="analytics-card fade-in">
            <div class="metric-header">
                <h4 class="metric-title">Top Video Views</h4>
                <div class="metric-icon">
                    <i class="fas fa-crown"></i>
                </div>
            </div>
            <div class="metric-value">{{ youtube_data.top_performing_video_views|format_number if youtube_data and youtube_data.top_performing_video_views else '0' }}</div>
            <div class="metric-change positive">
                <i class="fas fa-trophy me-1"></i>
                Best performer
            </div>
            <div class="metric-label">
                {% if youtube_data and youtube_data.top_performing_video_title %}
                    "{{ youtube_data.top_performing_video_title[:30] }}{% if youtube_data.top_performing_video_title|length > 30 %}...{% endif %}"
                {% else %}
                    No top video data
                {% endif %}
            </div>
        </div>
        </div>
        

        <!-- Performance Charts Section -->
        <div class="charts-grid">
            <!-- Channel Health Overview -->
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-heartbeat"></i> Channel Health Overview</h5>
                <div class="chart-wrapper">
                    <canvas id="channelHealthChart"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff6b35;"></div>
                        <span>Your Channel</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #6c757d;"></div>
                        <span>Industry Average</span>
                    </div>
                </div>
            </div>

            <!-- Engagement Distribution -->
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-chart-pie"></i> Engagement Distribution</h5>
                <div class="chart-wrapper">
                    <canvas id="engagementDistributionChart"></canvas>
                </div>
            </div>

            <!-- Content Categories -->
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-tags"></i> Content Categories</h5>
                <div class="chart-wrapper">
                    <canvas id="contentCategoriesChart"></canvas>
                </div>
            </div>

            <!-- Audience Demographics -->
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-users"></i> Audience Demographics</h5>
                <div class="chart-wrapper">
                    <canvas id="demographicsChart"></canvas>
                </div>
            </div>

            <!-- Growth Prediction -->
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-rocket"></i> Growth Prediction</h5>
                <div class="chart-wrapper">
                    <canvas id="growthTrajectoryChart"></canvas>
                </div>
            </div>

            <!-- Video Performance -->
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-chart-bar"></i> Video Performance Metrics</h5>
                <div class="chart-wrapper">
                    <canvas id="performanceDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- AI Insights -->
        <h3 class="text-light mb-3 fade-in"><i class="fas fa-robot"></i> AI-Powered Insights</h3>
        <div class="insights-grid">
            {% if youtube_data and youtube_data.ai_insights %}
                {% for insight in youtube_data.ai_insights %}
                <div class="insight-card fade-in">
                    <div class="insight-header">
                        <div class="insight-icon">
                            <i class="fas fa-{{ 'rocket' if insight.type == 'growth_opportunity' else 'lightbulb' if insight.type == 'content_strategy' else 'chart-line' if insight.type == 'engagement_boost' else 'dollar-sign' }}"></i>
                        </div>
                        <div class="insight-content">
                            <h4>{{ insight.title }}</h4>
                            <p>{{ insight.description }}</p>
                        </div>
                    </div>
                    <div class="insight-stats">
                        <div class="stat-item">
                            <div class="stat-value">{{ (insight.confidence * 100)|round }}%</div>
                            <div class="stat-label">Confidence</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ insight.priority|title }}</div>
                            <div class="stat-label">Priority</div>
                        </div>
                    </div>
                    {% if insight.actionable_steps %}
                    <div class="mt-3">
                        <h6 class="text-light mb-2">Actionable Steps:</h6>
                        {% for step in insight.actionable_steps[:3] %}
                        <div class="d-flex align-items-center mb-1">
                            <i class="fas fa-check text-success me-2" style="font-size: 0.7rem;"></i>
                            <span style="font-size: 0.8rem; color: var(--text-gray);">{{ step }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="insight-card fade-in">
                    <div class="insight-header">
                        <div class="insight-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="insight-content">
                            <h4>Connect YouTube Channel</h4>
                            <p>Connect your YouTube channel to get personalized AI insights and growth recommendations based on your actual performance data.</p>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- Enhanced Content Analysis -->
{% if youtube_data and youtube_data.content_analysis %}
<h3 class="text-light mb-3 fade-in"><i class="fas fa-palette"></i> Content Strategy Analysis</h3>
<div class="analytics-grid">
    <div class="analytics-card fade-in">
        <div class="metric-header">
            <h4 class="metric-title">Content Categories</h4>
            <div class="metric-icon">
                <i class="fas fa-tags"></i>
            </div>
        </div>
        <div class="metric-value">
            {% if youtube_data.content_analysis.content_categories %}
                {{ youtube_data.content_analysis.content_categories|length }}
            {% else %}
                0
            {% endif %}
        </div>
        <div class="metric-change neutral">
            <i class="fas fa-hashtag me-1"></i>
            Categories
        </div>
        <div class="metric-label">
            {% if youtube_data.content_analysis.content_categories %}
                {{ youtube_data.content_analysis.content_categories.keys()|join(', ') }}
            {% else %}
                No categories identified
            {% endif %}
        </div>
    </div>

    <div class="analytics-card fade-in">
        <div class="metric-header">
            <h4 class="metric-title">Publishing Frequency</h4>
            <div class="metric-icon">
                <i class="fas fa-calendar"></i>
            </div>
        </div>
        <div class="metric-value">
            {{ youtube_data.content_analysis.publishing_frequency.split(' ')[0] if youtube_data.content_analysis.publishing_frequency else 'Unknown' }}
        </div>
        <div class="metric-change neutral">
            <i class="fas fa-clock me-1"></i>
            Frequency
        </div>
        <div class="metric-label">
            {{ youtube_data.content_analysis.publishing_frequency if youtube_data.content_analysis.publishing_frequency else 'No frequency data' }}
        </div>
    </div>

    <div class="analytics-card fade-in">
        <div class="metric-header">
            <h4 class="metric-title">Content Diversity</h4>
            <div class="metric-icon">
                <i class="fas fa-shapes"></i>
            </div>
        </div>
        <div class="metric-value">{{ youtube_data.content_analysis.content_diversity_score|round(1) if youtube_data.content_analysis.content_diversity_score else '0' }}%</div>
        <div class="metric-change {{ 'positive' if youtube_data.content_analysis.content_diversity_score and youtube_data.content_analysis.content_diversity_score > 60 else 'neutral' }}">
            <i class="fas fa-{{ 'check-circle' if youtube_data.content_analysis.content_diversity_score and youtube_data.content_analysis.content_diversity_score > 60 else 'chart-pie' }} me-1"></i>
            Diversity
        </div>
        <div class="metric-label">
            Variety in your content types
        </div>
    </div>

    <div class="analytics-card fade-in">
        <div class="metric-header">
            <h4 class="metric-title">Trending Alignment</h4>
            <div class="metric-icon">
                <i class="fas fa-fire"></i>
            </div>
        </div>
        <div class="metric-value">{{ youtube_data.content_analysis.trending_alignment_score|round(1) if youtube_data.content_analysis.trending_alignment_score else '0' }}%</div>
        <div class="metric-change {{ 'positive' if youtube_data.content_analysis.trending_alignment_score and youtube_data.content_analysis.trending_alignment_score > 60 else 'neutral' }}">
            <i class="fas fa-{{ 'bolt' if youtube_data.content_analysis.trending_alignment_score and youtube_data.content_analysis.trending_alignment_score > 60 else 'chart-line' }} me-1"></i>
            Trend match
        </div>
        <div class="metric-label">
            Alignment with trending topics
        </div>
    </div>
</div>

<!-- Content Gaps -->
<!-- Content Gaps Section -->
{% if youtube_data.content_analysis and youtube_data.content_analysis.content_gaps %}
<div class="content-gaps-container fade-in">
    <h5 class="content-gaps-title">
        <i class="fas fa-lightbulb"></i>
        Content Gap Opportunities
    </h5>
    <div class="content-gaps-grid">
        {% for gap in youtube_data.content_analysis.content_gaps %}
        <div class="content-gap-badge">
            <i class="fas fa-plus"></i>
            {{ gap|title }}
        </div>
        {% endfor %}
    </div>
    <p class="content-gaps-description">
        These content types could help expand your audience and increase engagement
    </p>
</div>
{% else %}
<div class="content-gaps-container fade-in">
    <h5 class="content-gaps-title">
        <i class="fas fa-lightbulb"></i>
        Content Gap Opportunities
    </h5>
    <div class="content-gaps-empty">
        <i class="fas fa-search"></i>
        <p>No content gaps identified. Your content strategy appears well-rounded!</p>
    </div>
</div>
{% endif %}
{% endif %}
    </div>
</div>

<!-- Instagram Analytics -->
<div id="instagram-analytics" class="platform-content" style="display: none;">
    <div class="container">
        <!-- Platform Header -->
        <div class="platform-header fade-in">
            <div class="platform-logo" style="background: linear-gradient(135deg, #E1306C, #F77737);">
                <i class="fab fa-instagram"></i>
            </div>
            <div class="platform-info">
                <h3>@{{ instagram_username }}</h3>
                <p>
                    {% if instagram_data and instagram_data.profile_metrics %}
                        {{ instagram_data.profile_metrics.followers|format_number }} followers • 
                        {{ instagram_data.profile_metrics.total_posts }} posts • 
                        {{ instagram_data.engagement_metrics.avg_engagement_rate|round(1) }}% engagement
                    {% else %}
                        Example Instagram analytics data
                    {% endif %}
                </p>
            </div>
            <div class="performance-badge performance-good">
                <i class="fas fa-chart-line"></i>Good Performance
            </div>
        </div>

        <!-- Show example data message -->
        <div class="alert alert-info fade-in">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Note:</strong> This shows example Instagram data. Real Instagram API integration coming soon.
        </div>

        <!-- Key Metrics -->
        <div class="analytics-grid">
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Total Followers</h4>
                    <div class="metric-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                </div>
                <div class="metric-value">{{ instagram_data.profile_metrics.followers|format_number if instagram_data and instagram_data.profile_metrics else '12.5K' }}</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>+8.2% growth
                </div>
                <div class="metric-label">
                    {{ instagram_data.growth_predictions.follower_growth_30d|format_number if instagram_data and instagram_data.growth_predictions else '850' }} projected this month
                </div>
            </div>

            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Engagement Rate</h4>
                    <div class="metric-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                </div>
                <div class="metric-value">{{ instagram_data.engagement_metrics.avg_engagement_rate|round(1) if instagram_data and instagram_data.engagement_metrics else '4.8' }}%</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>+3.4% improvement
                </div>
                <div class="metric-label">
                    Industry average: 2.8% | 15K engagements
                </div>
            </div>

            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Account Reach</h4>
                    <div class="metric-icon">
                        <i class="fas fa-chart-network"></i>
                    </div>
                </div>
                <div class="metric-value">{{ instagram_data.engagement_metrics.reach|format_number if instagram_data and instagram_data.engagement_metrics else '45.2K' }}</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>+12.7% increase
                </div>
                <div class="metric-label">
                    Unique accounts | 25% from hashtags
                </div>
            </div>

            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Content Value</h4>
                    <div class="metric-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                </div>
                <div class="metric-value">${{ instagram_data.growth_predictions.estimated_value_per_post if instagram_data and instagram_data.growth_predictions else '250' }}</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>High potential
                </div>
                <div class="metric-label">
                    Estimated value per sponsored post
                </div>
            </div>
        </div>

        <!-- Instagram Charts -->
        <div class="charts-grid">
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-chart-line"></i> Follower Growth Trend</h5>
                <div class="chart-wrapper">
                    <canvas id="followerGrowthChart"></canvas>
                </div>
            </div>

            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-chart-pie"></i> Content Type Performance</h5>
                <div class="chart-wrapper">
                    <canvas id="contentTypeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Instagram Insights -->
        <h3 class="text-light mb-3 fade-in"><i class="fas fa-magic"></i> Instagram Optimization</h3>
        <div class="suggestions-grid">
            {% if instagram_data and instagram_data.ai_insights %}
                {% for insight in instagram_data.ai_insights %}
                <div class="suggestion-card fade-in">
                    <div class="suggestion-icon">
                        <i class="fas fa-{{ 'film' if insight.type == 'content_strategy' else 'poll' if insight.type == 'engagement_boost' else 'rocket' }}"></i>
                    </div>
                    <h5 class="suggestion-title">{{ insight.title }}</h5>
                    <p class="suggestion-desc">{{ insight.description }}</p>
                    <div class="mt-3">
                        {% for action in insight.suggested_actions[:2] %}
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-check text-success me-2" style="font-size: 0.8rem;"></i>
                            <span style="font-size: 0.85rem; color: var(--text-gray);">{{ action }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    <a href="#" class="suggestion-action mt-2">
                        View Details <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                {% endfor %}
            {% else %}
                <div class="suggestion-card fade-in">
                    <div class="suggestion-icon">
                        <i class="fas fa-film"></i>
                    </div>
                    <h5 class="suggestion-title">Boost Reels Performance</h5>
                    <p class="suggestion-desc">
                        Your tutorial reels get 3x more reach. Create more educational content in vertical format with trending audio.
                    </p>
                    <a href="#" class="suggestion-action">
                        Learn More <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="suggestion-card fade-in">
                    <div class="suggestion-icon">
                        <i class="fas fa-poll"></i>
                    </div>
                    <h5 class="suggestion-title">Increase Story Engagement</h5>
                    <p class="suggestion-desc">
                        Use polls, quizzes, and questions in stories to boost completion rates by 40% and gather valuable audience insights.
                    </p>
                    <a href="#" class="suggestion-action">
                        Learn More <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="suggestion-card fade-in">
                    <div class="suggestion-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h5 class="suggestion-title">Optimize Content Mix</h5>
                    <p class="suggestion-desc">
                        Balance your feed with 40% educational content, 30% behind-the-scenes, and 30% client success stories.
                    </p>
                    <a href="#" class="suggestion-action">
                        Learn More <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Performance Overview -->
<div id="overview-analytics" class="platform-content" style="display: none;">
    <div class="container">
        <div class="platform-header fade-in">
            <div class="platform-logo" style="background: linear-gradient(135deg, #ff6b35, #1e1e1e);">
                <i class="fas fa-chart-network"></i>
            </div>
            <div class="platform-info">
                <h3>Cross-Platform Performance</h3>
                <p>Comprehensive digital presence analysis across all channels</p>
            </div>
        </div>

        <!-- Overall Metrics -->
        <div class="analytics-grid">
            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Total Audience</h4>
                    <div class="metric-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="metric-value">
                    {% if youtube_data and youtube_data.subscribers and instagram_data and instagram_data.profile_metrics %}
                        {{ (youtube_data.subscribers + instagram_data.profile_metrics.followers)|format_number }}
                    {% else %}
                        {{ (youtube_data.subscribers|default(0) + 12500)|format_number }}
                    {% endif %}
                </div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>+10.3% growth
                </div>
                <div class="metric-label">
                    Combined reach across all platforms
                </div>
            </div>

            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Monthly Growth</h4>
                    <div class="metric-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                </div>
                <div class="metric-value">
                    {% if youtube_data and youtube_data.growth_predictions %}
                        +{{ (youtube_data.growth_predictions.predicted_monthly_growth_rate * youtube_data.subscribers / 100)|round|int|format_number }}
                    {% else %}
                        +2,350
                    {% endif %}
                </div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>
                    {% if youtube_data and youtube_data.growth_predictions %}
                        {{ youtube_data.growth_predictions.predicted_monthly_growth_rate|round(1) }}% increase
                    {% else %}
                        +9.8% increase
                    {% endif %}
                </div>
                <div class="metric-label">
                    New audience members this month
                </div>
            </div>

            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Engagement Score</h4>
                    <div class="metric-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="metric-value">
                    {% if youtube_data and youtube_data.channel_health %}
                        {{ (youtube_data.channel_health / 10)|round(1) }}
                    {% else %}
                        5.5
                    {% endif %}/10
                </div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up me-1"></i>
                    {% if youtube_data and youtube_data.engagement_rate %}
                        {{ (youtube_data.engagement_rate - 4.2)|round(1) }}% above average
                    {% else %}
                        +2.7% improvement
                    {% endif %}
                </div>
                <div class="metric-label">
                    Overall engagement health score
                </div>
            </div>

            <div class="analytics-card fade-in">
                <div class="metric-header">
                    <h4 class="metric-title">Content Velocity</h4>
                    <div class="metric-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                </div>
                <div class="metric-value">
                    {% if youtube_data and youtube_data.content_analysis %}
                        {% if 'High' in youtube_data.content_analysis.publishing_frequency %}
                            18
                        {% elif 'Moderate' in youtube_data.content_analysis.publishing_frequency %}
                            12
                        {% else %}
                            8
                        {% endif %}
                    {% else %}
                        18
                    {% endif %}
                </div>
                <div class="metric-change neutral">
                    <i class="fas fa-minus me-1"></i>Optimal range
                </div>
                <div class="metric-label">
                    Posts per week | Target: 15-25
                </div>
            </div>
        </div>

        <!-- Platform Comparison -->
        <div class="comparison-section fade-in">
            <h5 class="comparison-title">Platform Performance Comparison</h5>
            <div class="comparison-grid">
                <div class="comparison-item">
                    <div class="comparison-value">
                        {{ youtube_data.engagement_rate|round(1) if youtube_data and youtube_data.engagement_rate else '6.8' }}%
                    </div>
                    <div class="comparison-label">YouTube Engagement</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-value">
                        {{ instagram_data.engagement_metrics.avg_engagement_rate|round(1) if instagram_data and instagram_data.engagement_metrics else '4.2' }}%
                    </div>
                    <div class="comparison-label">Instagram Engagement</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-value">
                        {{ youtube_data.subscribers|format_number if youtube_data and youtube_data.subscribers else '15.2K' }}
                    </div>
                    <div class="comparison-label">YouTube Subscribers</div>
                </div>
                <div class="comparison-item">
                    <div class="comparison-value">
                        {{ instagram_data.profile_metrics.followers|format_number if instagram_data and instagram_data.profile_metrics else '8.7K' }}
                    </div>
                    <div class="comparison-label">Instagram Followers</div>
                </div>
            </div>
        </div>

        <!-- Performance Trends -->
        <h3 class="text-light mb-3 fade-in"><i class="fas fa-trending-up"></i> Performance Trends</h3>
        <div class="charts-grid">
            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-chart-line"></i> Growth Trajectory</h5>
                <div class="chart-wrapper">
                    <canvas id="growthTrajectoryChart"></canvas>
                </div>
            </div>

            <div class="chart-container fade-in">
                <h5 class="chart-title"><i class="fas fa-bullseye"></i> Performance Distribution</h5>
                <div class="chart-wrapper">
                    <canvas id="performanceDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Strategic Recommendations -->
        <h3 class="text-light mb-3 fade-in"><i class="fas fa-chess-knight"></i> Strategic Recommendations</h3>
        <div class="suggestions-grid">
            <div class="suggestion-card fade-in">
                <div class="suggestion-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <h5 class="suggestion-title">Cross-Platform Content Strategy</h5>
                <p class="suggestion-desc">
                    Repurpose YouTube tutorials into Instagram Reels and Twitter threads to maximize content reach and engagement across all platforms.
                </p>
                <a href="#" class="suggestion-action">
                    View Strategy <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <div class="suggestion-card fade-in">
                <div class="suggestion-icon">
                    <i class="fas fa-bullseye"></i>
                </div>
                <h5 class="suggestion-title">Audience Growth Campaign</h5>
                <p class="suggestion-desc">
                    Launch targeted campaigns focusing on the 18-34 age group, which represents 68% of your most engaged audience segments.
                </p>
                <a href="#" class="suggestion-action">
                    Plan Campaign <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <div class="suggestion-card fade-in">
                <div class="suggestion-icon">
                    <i class="fas fa-rocket"></i>
                </div>
                <h5 class="suggestion-title">Monetization Opportunities</h5>
                <p class="suggestion-desc">
                    With current growth rates, you can reach 50K total audience in 6 months, opening up sponsorship and partnership opportunities.
                </p>
                <a href="#" class="suggestion-action">
                    Explore Options <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Format number function
function formatNumber(num) {
    if (!num) return '0';
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toString();
}

// Initialize all charts and animations
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    initializeTabSystem();
    initializeAnimations();
    setupRefreshButtons();
});

// Tab System
function initializeTabSystem() {
    const tabs = document.querySelectorAll('.platform-tab');
    const contents = document.querySelectorAll('.platform-content');
    
    function switchTab(platform) {
        // Update active tab
        tabs.forEach(t => t.classList.remove('active'));
        document.querySelector(`[data-platform="${platform}"]`).classList.add('active');
        
        // Show corresponding content
        contents.forEach(content => {
            content.style.display = 'none';
            content.classList.remove('fade-in');
        });
        
        const activeContent = document.getElementById(`${platform}-analytics`);
        if (activeContent) {
            activeContent.style.display = 'block';
            setTimeout(() => activeContent.classList.add('fade-in'), 50);
        }
        
        // Reinitialize charts for the active tab
        setTimeout(initializeCharts, 300);
    }
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const platform = this.getAttribute('data-platform');
            switchTab(platform);
        });
    });
    
    // Initialize with YouTube
    switchTab('youtube');
}

// Refresh Buttons
function setupRefreshButtons() {
    const refreshButtons = document.querySelectorAll('.refresh-analytics-btn');
    
    refreshButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const platform = this.getAttribute('data-platform');
            const identifier = this.getAttribute('data-identifier');
            
            refreshAnalytics(platform, identifier, this);
        });
    });
}

function refreshAnalytics(platform, identifier, button) {
    const forceRefresh = button.getAttribute('data-force-refresh') === 'true';
    
    // Show loading state
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
    button.disabled = true;
    
    // Add loading class to platform content
    const platformContent = document.getElementById(`${platform}-analytics`);
    if (platformContent) {
        platformContent.classList.add('loading');
    }
    
    fetch('/admin/refresh-analytics', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            platform: platform,
            identifier: identifier,
            force_refresh: forceRefresh
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const message = data.data_source === 'cached_7day' ? 
                'Using cached data (refreshed weekly)' : 
                'Analytics refreshed with fresh data!';
            showNotification(message, 'success');
            
            // Reload the page to show updated data
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            showNotification('Error refreshing analytics: ' + data.message, 'error');
            resetButtonState(button, originalText, platformContent);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Error refreshing analytics', 'error');
        resetButtonState(button, originalText, platformContent);
    });
}
function resetButtonState(button, originalText, platformContent) {
    button.innerHTML = originalText;
    button.disabled = false;
    if (platformContent) {
        platformContent.classList.remove('loading');
    }
}

function showNotification(message, type) {
    // Remove existing notifications (except info alerts)
    document.querySelectorAll('.alert').forEach(alert => {
        if (!alert.classList.contains('alert-info')) {
            alert.remove();
        }
    });
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10000; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}

// Animations
function initializeAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.analytics-card, .chart-container, .insight-card, .suggestion-card').forEach(el => {
        observer.observe(el);
    });
}
// Enhanced Chart Initialization
function initializeCharts() {
    destroyExistingCharts();
    createEnhancedYouTubeCharts();
    createEnhancedInstagramCharts();
    createEnhancedOverviewCharts();
}

function destroyExistingCharts() {
    Chart.helpers.each(Chart.instances, (instance) => {
        instance.destroy();
    });
}

// Enhanced YouTube Charts
function createEnhancedYouTubeCharts() {
    createChannelHealthChart();
    createEngagementDistributionChart();
    createContentCategoriesChart();
    createAudienceDemographicsChart();
    createGrowthPredictionChart();
    createVideoPerformanceChart();
}

function createChannelHealthChart() {
    const ctx = document.getElementById('channelHealthChart')?.getContext('2d');
    if (!ctx) return;

    const channelHealth = {{ youtube_data.channel_health|default(0) }};
    const engagementRate = {{ youtube_data.engagement_rate|default(0) }};
    const performanceConsistency = {{ youtube_data.performance_consistency|default(0) }};
    const contentQuality = {{ youtube_data.content_quality_score|default(0) }};
    const growthPotential = {% if youtube_data and youtube_data.growth_potential %}{% if youtube_data.growth_potential == 'High' %}90{% elif youtube_data.growth_potential == 'Medium' %}70{% else %}50{% endif %}{% else %}50{% endif %};

    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Channel Health', 'Engagement', 'Consistency', 'Content Quality', 'Growth Potential'],
            datasets: [{
                label: 'Your Channel',
                data: [
                    channelHealth,
                    Math.min(engagementRate * 10, 100), // Scale engagement rate
                    performanceConsistency,
                    contentQuality,
                    growthPotential
                ],
                backgroundColor: 'rgba(255, 107, 53, 0.2)',
                borderColor: '#ff6b35',
                borderWidth: 2,
                pointBackgroundColor: '#ff6b35',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#ff6b35',
                pointRadius: 4,
                pointHoverRadius: 6
            }, {
                label: 'Industry Average',
                data: [65, 65, 70, 65, 60],
                backgroundColor: 'rgba(108, 117, 125, 0.1)',
                borderColor: '#6c757d',
                borderWidth: 2,
                pointBackgroundColor: '#6c757d',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#6c757d',
                pointRadius: 3,
                borderDash: [5, 5]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 2000,
                easing: 'easeOutQuart'
            },
            scales: {
                r: {
                    angleLines: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    pointLabels: {
                        color: '#888',
                        font: {
                            size: 11,
                            weight: '600'
                        }
                    },
                    ticks: {
                        color: '#888',
                        backdropColor: 'transparent',
                        stepSize: 20
                    },
                    beginAtZero: true,
                    max: 100
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#888',
                        font: {
                            size: 11
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(42, 42, 42, 0.95)',
                    titleColor: '#fff',
                    bodyColor: '#ccc',
                    borderColor: 'rgba(255, 107, 53, 0.3)',
                    borderWidth: 1,
                    callbacks: {
                        label: function(context) {
                            const label = context.dataset.label || '';
                            const value = context.parsed.r;
                            let description = '';
                            
                            switch(context.dataIndex) {
                                case 0: description = 'Overall channel performance score'; break;
                                case 1: description = 'Audience interaction rate'; break;
                                case 2: description = 'Performance stability across videos'; break;
                                case 3: description = 'Content quality assessment'; break;
                                case 4: description = 'Future growth potential'; break;
                            }
                            
                            return `${label}: ${value.toFixed(1)}/100 - ${description}`;
                        }
                    }
                }
            }
        }
    });
}

function createEngagementDistributionChart() {
    const ctx = document.getElementById('engagementDistributionChart')?.getContext('2d');
    if (!ctx) return;

    const likes = {{ youtube_data.total_likes|default(0) }};
    const comments = {{ youtube_data.total_comments|default(0) }};
    const views = {{ youtube_data.total_views|default(0) }};

    // Calculate percentages for better visualization
    const totalEngagement = likes + comments;
    const likesPercent = totalEngagement > 0 ? (likes / totalEngagement) * 100 : 0;
    const commentsPercent = totalEngagement > 0 ? (comments / totalEngagement) * 100 : 0;

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Likes', 'Comments'],
            datasets: [{
                data: [likesPercent, commentsPercent],
                backgroundColor: ['#ff6b35', '#ff8c5a'],
                borderColor: ['#ff6b35', '#ff8c5a'],
                borderWidth: 2,
                hoverBackgroundColor: ['#ff8c5a', '#ffa87d']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '65%',
            animation: {
                animateScale: true,
                animateRotate: true,
                duration: 2000,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#888',
                        font: {
                            size: 11
                        },
                        padding: 15
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            return `${label}: ${value.toFixed(1)}%`;
                        }
                    }
                }
            }
        }
    });
}

function createContentCategoriesChart() {
    const ctx = document.getElementById('contentCategoriesChart')?.getContext('2d');
    if (!ctx) return;

    // Use actual data from backend or fallback
    const contentAnalysis = {{ youtube_data.content_analysis|tojson|default('{}') }};
    let labels = [];
    let data = [];
    
    if (contentAnalysis && contentAnalysis.content_categories && Object.keys(contentAnalysis.content_categories).length > 0) {
        // Use actual categories from your data
        const categories = contentAnalysis.content_categories;
        const sortedCategories = Object.entries(categories)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 6); // Top 6 categories
        
        labels = sortedCategories.map(item => item[0]);
        data = sortedCategories.map(item => item[1]);
        
        // Normalize data to percentages for better visualization
        const total = data.reduce((sum, value) => sum + value, 0);
        if (total > 0) {
            data = data.map(value => (value / total) * 100);
        }
    } else {
        // Balanced fallback data
        labels = ['Tutorials', 'Educational', 'Entertainment', 'Tech', 'Reviews', 'Vlogs'];
        data = [35, 25, 15, 12, 8, 5];
    }

    const backgroundColors = [
        '#ff6b35', '#ff8c5a', '#ffa87d', '#ffc4a6', '#ffe0ce', '#e55a2b'
    ];

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: backgroundColors,
                borderColor: backgroundColors.map(color => color),
                borderWidth: 2,
                hoverBackgroundColor: backgroundColors.map(color => color + 'DD'),
                hoverOffset: 15
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                animateRotate: true,
                animateScale: true,
                duration: 2000
            },
            plugins: {
                legend: {
                    position: 'right',
                    labels: { 
                        color: '#888',
                        font: {
                            size: 11
                        },
                        padding: 12
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            return `${label}: ${value.toFixed(1)}%`;
                        }
                    }
                }
            }
        }
    });
}

function createAudienceDemographicsChart() {
    const ctx = document.getElementById('demographicsChart')?.getContext('2d');
    if (!ctx) return;

    // Use actual data or fallback
    const demographics = {{ youtube_data.demographics|tojson|default('{}') }};
    const ageGroups = demographics.age_groups || { '18-24': 35, '25-34': 40, '35-44': 15, '45+': 10 };

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(ageGroups),
            datasets: [{
                label: 'Age Distribution (%)',
                data: Object.values(ageGroups),
                backgroundColor: 'rgba(255, 107, 53, 0.8)',
                borderColor: '#ff6b35',
                borderWidth: 1,
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 1500 },
            plugins: { 
                legend: { 
                    display: false 
                } 
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: { 
                        color: '#888',
                        callback: function(value) { return value + '%'; }
                    }
                },
                x: {
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: { color: '#888' }
                }
            }
        }
    });
}

function createGrowthPredictionChart() {
    const ctx = document.getElementById('growthTrajectoryChart')?.getContext('2d');
    if (!ctx) return;

    const currentSubs = {{ youtube_data.subscribers|default(1000) }};
    const growthRate = {{ youtube_data.growth_predictions.predicted_monthly_growth_rate|default(5) }}/100;
    
    const months = ['Now', '1M', '3M', '6M', '1Y'];
    const projectedData = [
        currentSubs,
        Math.round(currentSubs * (1 + growthRate)),
        Math.round(currentSubs * Math.pow(1 + growthRate, 3)),
        Math.round(currentSubs * Math.pow(1 + growthRate, 6)),
        Math.round(currentSubs * Math.pow(1 + growthRate, 12))
    ];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Projected Subscribers',
                data: projectedData,
                borderColor: '#ff6b35',
                backgroundColor: 'rgba(255, 107, 53, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#ff6b35',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 2000,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#888'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `Subscribers: ${formatNumber(context.parsed.y)}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#888',
                        callback: function(value) {
                            return formatNumber(value);
                        }
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#888'
                    }
                }
            }
        }
    });
}

function createVideoPerformanceChart() {
    const ctx = document.getElementById('performanceDistributionChart')?.getContext('2d');
    if (!ctx) return;

    const avgViews = {{ youtube_data.avg_views_per_video|default(0) }};
    const avgLikes = {{ youtube_data.avg_likes_per_video|default(0) }};
    const avgComments = {{ youtube_data.avg_comments_per_video|default(0) }};
    const engagementConsistency = {{ youtube_data.engagement_consistency|default(0) }};
    const performanceConsistency = {{ youtube_data.performance_consistency|default(0) }};

    // Ensure minimum values for visibility
    const minBarHeight = 2; // Minimum 2% height for visibility
    
    const viewsNormalized = Math.max((avgViews / 1000) * 10, minBarHeight);
    const likesNormalized = Math.max((avgLikes / 100) * 10, minBarHeight);
    const commentsNormalized = Math.max((avgComments * 5), minBarHeight); // Scale comments more
    const engagementNormalized = Math.max(engagementConsistency * 0.8, minBarHeight);
    const performanceNormalized = Math.max(performanceConsistency * 0.8, minBarHeight);

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Avg Views', 'Avg Likes', 'Avg Comments', 'Engagement Consistency', 'Performance Consistency'],
            datasets: [{
                label: 'Performance Metrics',
                data: [
                    viewsNormalized,
                    likesNormalized, 
                    commentsNormalized,
                    engagementNormalized,
                    performanceNormalized
                ],
                backgroundColor: [
                    'rgba(255, 107, 53, 0.8)',
                    'rgba(255, 140, 90, 0.8)',
                    'rgba(255, 168, 125, 0.8)',
                    'rgba(255, 196, 166, 0.8)',
                    'rgba(229, 90, 43, 0.8)'
                ],
                borderColor: [
                    '#ff6b35',
                    '#ff8c5a',
                    '#ffa87d',
                    '#ffc4a6',
                    '#e55a2b'
                ],
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 1500,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label;
                            let value = '';
                            
                            switch(label) {
                                case 'Avg Views':
                                    value = formatNumber(avgViews) + ' views';
                                    break;
                                case 'Avg Likes':
                                    value = formatNumber(avgLikes) + ' likes';
                                    break;
                                case 'Avg Comments':
                                    value = formatNumber(avgComments) + ' comments';
                                    break;
                                case 'Engagement Consistency':
                                    value = engagementConsistency.toFixed(1) + '% consistency';
                                    break;
                                case 'Performance Consistency':
                                    value = performanceConsistency.toFixed(1) + '% consistency';
                                    break;
                            }
                            
                            return `${label}: ${value}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#888',
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#888'
                    }
                }
            }
        }
    });
}

// Enhanced Instagram Charts (placeholder - update with real data when available)
function createEnhancedInstagramCharts() {
    createFollowerGrowthChart();
    createContentTypeChart();
}

function createFollowerGrowthChart() {
    const ctx = document.getElementById('followerGrowthChart')?.getContext('2d');
    if (!ctx) return;

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            datasets: [{
                label: 'Followers',
                data: [5200, 5800, 6200, 6800, 7300, 8000, 8700],
                borderColor: '#E1306C',
                backgroundColor: 'rgba(225, 48, 108, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#E1306C',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 2000,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#888'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#888',
                        callback: function(value) {
                            return formatNumber(value);
                        }
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#888'
                    }
                }
            }
        }
    });
}

function createContentTypeChart() {
    const ctx = document.getElementById('contentTypeChart')?.getContext('2d');
    if (!ctx) return;

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Reels', 'Posts', 'Stories', 'Carousels'],
            datasets: [{
                data: [45, 25, 20, 10],
                backgroundColor: [
                    '#E1306C',
                    '#F77737',
                    '#FCAF45',
                    '#FFDC80'
                ],
                borderColor: [
                    '#E1306C',
                    '#F77737',
                    '#FCAF45',
                    '#FFDC80'
                ],
                borderWidth: 2,
                hoverOffset: 15
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                animateScale: true,
                animateRotate: true,
                duration: 2000,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#888',
                        padding: 15
                    }
                }
            }
        }
    });
}

function createEnhancedOverviewCharts() {
    // Add any additional overview charts here
}

// Enhanced formatNumber function
function formatNumber(num) {
    if (!num || isNaN(num)) return '0';
    
    num = parseFloat(num);
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return Math.round(num).toString();
}
</script>
{% endblock %}